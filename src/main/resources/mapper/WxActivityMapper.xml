<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scoprion.mall.wx.mapper.WxActivityMapper">

    <resultMap type="com.scoprion.mall.domain.ActivityGoods" id="activityResult" extends="goods">
        <result property="id" column="id"/>
        <result property="activityType" column="activity_type"/>
        <result property="name" column="name"/>
        <result property="num" column="num"/>
        <result property="activityId" column="activity_id"/>
        <result property="status" column="status"/>
        <result property="createDate" column="create_date"/>
    </resultMap>

    <resultMap type="com.scoprion.mall.domain.Goods" id="goods">
        <result property="id" column="id"/>
        <result property="categoryId" column="category_id"/>
        <result property="goodName" column="good_name"/>
        <result property="description" column="description"/>
        <result property="promotion" column="promotion"/>
        <result property="price" column="price"/>
        <result property="saleVolume" column="sale_volume"/>
        <result property="discount" column="discount"/>
        <result property="stock" column="stock"/>
        <result property="onSale" column="on_sale"/>
        <result property="hot" column="hot"/>
        <result property="isNew" column="is_new"/>
        <result property="lastUpdateDate" column="last_update_date"/>
        <result property="freight" column="freight"/>
        <result property="brandId" column="brand_id"/>
        <result property="sellerId" column="seller_id"/>
        <result property="visitTotal" column="visit_total"/>
        <result property="goodNo" column="good_no"/>
        <result property="mainImgUrl" column="main_image_url"/>
        <result property="status" column="status"/>
    </resultMap>

    <!-- 拼团 -->
    <select id="findByGroup" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.num,
        act.discount,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        actg.stock,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act LEFT JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id = tg.id
        AND act.activity_type = '1' AND actg.status='0' AND act.status='0'
    </select>
    <!-- 根据类型与时间计算拼团是否开始 activityType = 2 -->
    <select id="findByActivityTypeTwo" resultType="com.scoprion.mall.domain.Activity">
        SELECT * FROM t_activity WHERE id = '2'
    </select>

    <!-- 秒杀 -->
    <select id="secKill" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.target,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act INNER JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id=tg.id
        AND act.activity_type = '0' AND actg.status='0'AND act.status='0'
    </select>
    <!-- 根据类型与时间计算秒杀是否开始 activityType = 1 -->
    <select id="findByActivityTypeOne" resultType="com.scoprion.mall.domain.Activity">
        SELECT * FROM t_activity WHERE id = '1'
    </select>

    <!-- 优选 -->
    <select id="preference" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.target,
        actg.id,
        actg.activityId,
        actg.good_id,
        actg.create_date,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_ale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act INNER JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.goodId=tg.id
        AND act.activity_type = '2' AND actg.status='0'AND act.status='0'
    </select>
    <!-- 根据类型与时间计算优选是否开始 activityType = 3 -->
    <select id="findByActivityTypeThree" resultType="com.scoprion.mall.domain.Activity">
        SELECT * FROM t_activity WHERE id = '3'
    </select>

    <!-- 查询试用商品列表 -->
    <select id="findAll" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.num,
        act.discount,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        actg.stock,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act LEFT JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.goodId = tg.id
        AND act.activity_type = '3' AND actg.status='0' AND act.status='0'
    </select>
</mapper>