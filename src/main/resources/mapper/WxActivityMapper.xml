<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scoprion.mall.wx.mapper.WxActivityMapper">

    <resultMap type="com.scoprion.mall.domain.ActivityGoods" id="activityResult" extends="goods">
        <result property="id" column="id"/>
        <result property="activityType" column="activityType"/>
        <result property="name" column="name"/>
        <result property="num" column="num"/>
        <result property="activityId" column="activityId"/>
        <result property="status" column="status"/>
        <result property="actgId" column="actgId"/>
        <result property="actgStock" column="actgStock"/>
        <result property="createDate" column="createDate"/>
    </resultMap>

    <resultMap type="com.scoprion.mall.domain.Goods" id="goods">
        <result property="id" column="id"/>
        <result property="categoryId" column="categoryId"/>
        <result property="goodName" column="goodName"/>
        <result property="description" column="description"/>
        <result property="promotion" column="promotion"/>
        <result property="price" column="price"/>
        <result property="saleVolume" column="saleVolume"/>
        <result property="discount" column="discount"/>
        <result property="stock" column="stock"/>
        <result property="isOnSale" column="isOnSale"/>
        <result property="isHot" column="isHot"/>
        <result property="isNew" column="isNew"/>
        <result property="lastUpdateDate" column="lastUpdateDate"/>
        <result property="isFreight" column="isFreight"/>
        <result property="brandId" column="brandId"/>
        <result property="sellerId" column="sellerId"/>
        <result property="visitTotal" column="visitTotal"/>
        <result property="goodNo" column="goodNo"/>
        <result property="mainImgUrl" column="mainImgUrl"/>
        <result property="status" column="status"/>
    </resultMap>

    <!-- 拼团 -->
    <select id="findByGroup" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.num,
        act.discount,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        actg.stock AS actgstock,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act LEFT JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id = tg.id
        AND act.activity_type = '1' AND actg.status='0' AND act.status='0'
    </select>
    <!-- 根据类型与时间计算拼团是否开始 activityType = 2 -->
    <select id="findByActivityTypeTwo" resultType="com.scoprion.mall.domain.Activity">
        SELECT
        id,
        name,
        activity_type,
        status,
        update_date,
        create_date,
        target,
        num,
        start_date,
        end_date,
        discount,
        describes
        FROM t_activity WHERE id = '2'
    </select>

    <!-- 秒杀 -->
    <select id="secKill" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.target,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act INNER JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id=tg.id
        AND act.activity_type = '0' AND actg.status='0'AND act.status='0'
    </select>
    <!-- 根据类型与时间计算秒杀是否开始 activityType = 1 -->
    <select id="findByActivityTypeOne" resultType="com.scoprion.mall.domain.Activity">
        SELECT
        id,
        name,
        activity_type,
        status,
        update_date,
        create_date,
        target,
        num,
        start_date,
        end_date,
        discount,
        describes
        FROM t_activity WHERE id = '1'
    </select>

    <!-- 优选 -->
    <select id="preference" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.target,
        actg.id,
        actg.activity_id,
        actg.good_id,
        actg.create_date,
        tg.id,
        tg.category_id,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        tg.stock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act INNER JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id=tg.id
        AND act.activity_type = '2' AND actg.status='0'AND act.status='0'
    </select>
    <!-- 根据类型与时间计算优选是否开始 activityType = 3 -->
    <select id="findByActivityTypeThree" resultType="com.scoprion.mall.domain.Activity">
        SELECT
        id,
        name,
        activity_type,
        status,
        update_date,
        create_date,
        target,
        num,
        start_date,
        end_date,
        discount,
        describes
        FROM t_activity WHERE id = '3'
    </select>

    <!-- 查询试用商品列表 -->
    <select id="findAll" resultMap="activityResult">
        SELECT
        act.name,
        act.activity_type,
        act.status,
        act.num,
        act.discount,
        actg.id AS activityGoodId,
        actg.activity_d,
        actg.good_d,
        actg.create_date,
        actg.stock AS actgStock,
        tg.good_name,
        tg.description,
        tg.promotion,
        tg.price,
        tg.sale_volume,
        tg.discount,
        actg.stock,
        tg.stock AS tgStock,
        tg.on_sale,
        tg.hot,
        tg.is_new,
        tg.last_update_date,
        tg.freight,
        tg.brand_id,
        tg.seller_id,
        tg.visit_total,
        tg.good_no,
        tg.main_image_url,
        tg.status
        FROM t_activity act LEFT JOIN t_activity_good actg ON act.id = actg.activity_id
        INNER JOIN t_good tg ON actg.good_id = tg.id
        AND act.activity_type = '3' AND actg.status='0' AND act.status='0'
    </select>

    <!-- 查询活动商品详情 -->
    <select id="findByActivityGoodId" resultType="com.scoprion.mall.domain.ActivityGoods">
        SELECT
        id,
        name,
        activity_type,
        status,
        update_date,
        create_date,
        target,
        num,
        start_date,
        end_date,
        discount,
        describes
        FROM t_activity_good WHERE id=#{activityGoodId}
    </select>

    <!-- 查询是否参加过该活动 -->
    <select id="validByActivityId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_order WHERE order_type='4' AND userId=#{userId}
    </select>


    <!-- 查询商品详情 -->
    <select id="findById" resultType="com.scoprion.mall.domain.Activity">
        SELECT
        id,
        name,
        activity_type,
        status,
        update_date,
        create_date,
        target,
        num,
        start_date,
        end_date,
        discount,
        describes
        FROM t_activity WHERE id=#{activityId}
    </select>

    <!-- 获取商品详情 -->
    <select id="findByGoodId" resultType="com.scoprion.mall.domain.Goods">
        SELECT
        id,
        good_no,
        category_id,
        good_name,
        description,
        promotion,
        price,
        sale_volume,
        discount,
        stock,
        on_sale,
        hot,
        is_new,
        create_date,
        last_update_date,
        freight,
        brand_id,
        seller_id,
        visit_total,
        main_image_url,
        rich_content,
        status
        FROM t_good WHERE id=#{goodId}
    </select>
</mapper>