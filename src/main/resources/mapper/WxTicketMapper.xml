<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.scoprion.mall.wx.mapper.WxTicketMapper">

    <!-- 优惠卷列表 -->
    <select id="findByUserId" resultType="com.scoprion.mall.domain.TicketExt">
        SELECT
        tks.id,
        tku.userId ,
        tks.createDate,
        tks.num,
        tks.ticketName,
        tks.content,
        tks.money,
        tks.ticketNo,
        tks.status,
        tks.useRange,
        tks.numLimit,
        tks.type,
        tks.startDate,
        tks.endDate
        FROM t_ticket_snapshot tks  LEFT JOIN t_ticket_user  tku  ON tks.id=tku.ticketId
        WHERE   tku.userId=#{userId}
    </select>

    <!-- 根据用户id、优惠券id查询记录 -->
    <select id="findByTicketIdAndUserId" resultType="com.scoprion.mall.domain.TicketUser">
        SELECT
        id,
        userId,
        ticketId,
        num,
        createDate,
        useDate,
        status
        FROM t_ticket_user WHERE userId=#{userId} AND ticketId=#{ticketId}
    </select>

    <!--新增优惠券-y用户关系记录-->
    <insert id="addTicketUser" parameterType="com.scoprion.mall.domain.TicketUser">
        INSERT  INTO t_ticket_user(userId,ticketId,num,createDate,useDate,status)
        VALUES
        (#{userId},#{ticketId},#{num},now(),#{useDate},#{status})
    </insert>

    <select id="findById" resultType="com.scoprion.mall.domain.Ticket">
        SELECT
        id,
        ticketNo,
        ticketName,
        type,
        content,
        startDate,
        endDate,
        createDate,
        updateDate,
        money,
        num,
        status,
        useRange,
        numLimit
        FROM  t_ticket WHERE  id=#{id}
    </select>
</mapper>