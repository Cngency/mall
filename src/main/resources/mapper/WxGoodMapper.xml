<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scoprion.mall.wx.mapper.WxGoodMapper">

    <!--首页商品列表-->
    <select id="findOnline" resultType="com.scoprion.mall.domain.Goods">
        SELECT
        id,
        category_id,
        good_name,
        description,
        promotion,
        price,
        sale_volume,
        discount,
        stock,
        on_sale,
        hot,
        is_new,
        create_date,
        last_update_date,
        freight,
        brand_id,
        seller_id,
        visit_total,
        good_no,
        main_image_url,
        rich_content
        FROM t_good WHERE on_sale='1' AND status='0'
    </select>

    <!--根据商品id查询详情-->
    <select id="findById" resultType="com.scoprion.mall.domain.GoodExt">
        SELECT
        good.id,
        good.category_id,
        good.good_name,
        good.description,
        good.promotion,
        good.price,
        good.sale_volume,
        good.discount,
        good.on_sale,
        good.hot,
        good.is_new,
        good.create_date,
        good.last_update_date,
        good.freight,
        good.brand_id,
        good.seller_id,
        good.visit_total,
        good.good_no,
        good.main_image_url,
        good.status,
        good.stock,
        good.rich_content,
        tacg.id,
        tacg.activity_id,
        tacg.good_id,
        tacg.create_date,
        tacg.good_name,
        tacg.stock AS activityStock,
        tacg.status,
        tacg.update_date
        FROM t_good good
        LEFT JOIN t_activity_good tacg ON good.id=tacg.good_id
        WHERE good.id=#{goodId} GROUP BY good.id
    </select>

    <!--商品搜素-->
    <select id="findBySearchKey" resultType="com.scoprion.mall.domain.Goods">
        SELECT
        id,
        category_id,
        good_name,
        description,
        promotion,
        good_no,
        price,
        main_image_url
        FROM t_good
        WHERE isOnSale='1' AND status='0'
        <if test="searchKey!=null and searchKey!=''">AND seo LIKE #{searchKey}</if>
    </select>

    <!--库存扣减-->
    <update id="updateGoodStockById">
        UPDATE t_good SET stock=(stock-#{stock}) WHERE id=#{goodId}
    </update>

    <!--修改销量-->
    <update id="updateSaleVolume">
        UPDATE t_good SET sale_volume=(sale_volume+#{saleVolume}) WHERE id=#{goodId}
    </update>

    <!-- 访问量 -->
    <update id="updateVisitTotal">
        UPDATE t_good SET visit_total=visit_total+1 WHERE id=#{goodId}
    </update>

</mapper>