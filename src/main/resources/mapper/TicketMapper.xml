<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scoprion.mall.backstage.mapper.TicketMapper">

    <!--增加-->
    <insert id="add" parameterType="com.scoprion.mall.domain.Ticket">
        INSERT INTO t_ticket
        (ticketName,content,startDate,endDate,money,num,status,createDate,ticketNo,type)
        VALUES
        (#{ticketName},#{content},#{startDate},#{endDate},#{money},#{num},#{status},now(),#{ticketNo},#{type})
    </insert>

    <!--修改-->
    <update id="modify" parameterType="com.scoprion.mall.domain.Ticket">
        UPDATE t_ticket SET
        <if test="ticketName!=null and ticketName!=''">ticketName=#{ticketName},</if>
        <if test="content!=null and content!=''">content =#{content},</if>
        <if test="startDate!=null and startDate!=''">startDate=#{startDate},</if>
        <if test="endDate!=null and endDate!=''">endDate=#{endDate},</if>
        <if test="money!=null and money!=''">money=#{money},</if>
        <if test="num!=null and num!=''">num=#{num},</if>
        <if test="status!=null and status!=''">status=#{status},</if>
        <if test="ticketNo!=null and ticketNo!=''">ticketNo=#{ticketNo},</if>
        <if test="type!=null and type!=''">type=#{type},</if>
        updateDate=now()
        WHERE id=#{id}
    </update>

    <!--删除-->
    <update id="deleteById">
        UPDATE t_ticket SET status='1',updateDate=now()
        WHERE id=#{id}
    </update>

    <!--查询活动名称数量-->
    <select id="validByName" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM  t_ticket WHERE  ticketName=#{ticketName} AND status='0'
    </select>

    <!--活动id、名称校验-->
    <select id="validByNameAndId" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM t_ticket WHERE ticketName =#{ticketName} AND id!=#{id} AND status='0'
    </select>

    <!--列表-->
    <select id="listPage" resultType="com.scoprion.mall.domain.Ticket">
        SELECT id,
        ticketName,
        content,
        startDate,
        endDate,
        money,
        num,
        status,
        createDate,
        ticketNo,
        type,
        updateDate
        FROM t_ticket where 1=1
        <if test="searchKey!=null">AND CONCAT(ticketName,content) LIKE #{searchKey}</if>
    </select>

    <!--查询详情-->
    <select id="findById" resultType="com.scoprion.mall.domain.Ticket">
        SELECT  id,
        ticketName,
        ticketNo,
        type,
        content,
        startDate,
        endDate,
        createDate,
        updateDate,
        money,
        num,
        status
        FROM  t_ticket WHERE id=#{id}
    </select>
</mapper>